[[datetime-conversions]]
= Date and Time Conversions

[abstract]
--
This section describes functions for formatting and operating on dates and times.
--

The date and time procedures retrieve current values, convert formats, set expirations, add/subtract from values, and split components into fields.
We may use these procedures to pull or send data to/from other systems and compare values.
The procedures described in this section support standard native Neo4j and Java date formats.

This section includes:

* <<date-available-procedures, Available Procedures>>
* <<date-parameter-options, Available Parameter Values>>
* <<add-subtract-date-operations, Addition/Subtraction Date Operations>>
* <<date-examples, Examples>>
    ** <<date-conversions, Converting Dates>>
    ** <<date-formatting, Formatting Dates>>    
    ** <<date-parsing, Parsing Dates>>
    ** <<date-fields, Splitting Dates to Fields>>

[[date-available-procedures]]
== Available Procedures

The table below describes the available procedures:

[separator=Â¦,opts=header,cols="1,1m,1m,5"]
|===
include::../../../build/generated-documentation/apoc.date.csv[]
|===

[[date-parameter-options]]
== Available Procedure and Function Parameter Values

In the available procedure list above, there are several parameters with specific values.
This section will show the available substitutions for different formats to apply to various cases.

[cols="1m,5"]
|===
| Parameter | Description | Possible Values | Examples
| `addUnit` | Measurement of units to add or subtract | `ms, s, m, h, d` (long forms: `millis, milliseconds, seconds, minutes, hours, days`) | `h`, `d`, `seconds`
| `addValue` | The number to add or subtract (for subtraction, use negative numbers) | Any positive or negative integer | `-365`, `30`, `7`, `-24`
| `convertTo` | Format of date conversion output | Any https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html[pre-defined Java format^], https://www.elastic.co/guide/en/elasticsearch/reference/5.5/mapping-date-format.html#built-in-date-formats[built-in format^], or specified pattern | `'yyyy-MM-dd HH:mm:ss.SSS'`, `'iso_date_format'`, `'basic_date'`
| `currentFormat` or `format` | Format of date to convert | May accept https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html[pre-defined Java format^], https://www.elastic.co/guide/en/elasticsearch/reference/5.5/mapping-date-format.html#built-in-date-formats[built-in format^], or specified pattern | `'yyyy-MM-dd HH:mm:ss.SSS'`, `'BASIC_ISO_DATE'`, `'date_time'`
| `time` | The value to convert or manipulate in time format | Any value often in epoch seconds or millisecond format | `1540944000`, `1582209630000`
| `timezone` | Specify timezone for result output | Full name values or UTC offsets - see https://en.wikipedia.org/wiki/List_of_tz_database_time_zones[this Wikipedia page] for list | `'America/Toronto'`, `'-05:00'`
| `toUnit` | Measurement of units for output value | `ms, s, m, h, d` (long forms: `millis, milliseconds, seconds, minutes, hours, days`) | `s`, `days`
| `unit` | Measurement of units for input value | `ms, s, m, h, d` (long forms: `millis, milliseconds, seconds, minutes, hours, days`) | `milliseconds`, `h`
|===

//LEFT OFF HERE!
== Notes on Values:

.Formats
* the default format is `yyyy-MM-dd HH:mm:ss`
* if the format pattern doesn't specify timezone, formatter considers dates to belong to the UTC timezone
* if the timezone pattern is specified in the input value, the timezone is extracted from the date string, otherwise an error will be reported
* the `to/fromSeconds` timestamp values are in POSIX (Unix time) system, i.e. timestamps represent the number of seconds elapsed since https://en.wikipedia.org/wiki/Unix_time[00:00:00 UTC, Thursday, 1 January 1970]
* the full list of supported formats is described in https://docs.oracle.com/javase/8/docs/api/java/text/SimpleDateFormat.html[SimpleDateFormat JavaDoc^]

////
- apoc.date.parse does NOT take 'months' or 'years' as from unit parameter
- apoc.date.convert does NOT take 'months' or 'years' as from or to unit parameter
- apoc.date.expire* procs need to be moved/renamed to apoc.ttl.*
- apoc.date.add will accept whole number values only (no decimals) and does NOT take 'months' or 'years' for addUnit parameter
- apoc.date.format only accepts string representations of format parameter, if submit 'd' as format, it only returns that field of the date (does NOT take 'months' or 'years' as the format parameter)
** unit and format are totally different (unit: 'h', 's', 'd' or 'hours', 'seconds', 'days'...format: 'd' day-of-month, 'y' year)
** unit is time value (short or long form), format is string representation of component field
- apoc.date.fromISO8601 requires format of 'yyyy-MM-ddTHH:mm:ss.SSSZ' (include 'T' before time and 'Z' as zone)
- apoc.date.parseAsZonedDateTime accepts only a UTC timezone value
- apoc.date.systemTimezone does not accept any arguments
- apoc.date.toISO8601 unit does NOT take 'months' or 'years' as parameter
- apoc.date.toYears
////

== Current timestamp

`apoc.date.currentTimestamp()` provides the System.currentTimeMillis which is current throughout transaction execution compared to Cypher's timestamp() function which does not update within a transaction

.The following captures the current timestamp, sleeps for 1 second, and then captures the current timestamp again:
[source,cypher]
----
WITH apoc.date.currentTimestamp() as start
CALL apoc.util.sleep(1000)
RETURN start, apoc.date.currentTimestamp() AS end;
----

.Results
[opts="header",cols="1, 1"]
|===
| Start | End
| 1561386222609 | 1561386223612
|===

== Conversion of timestamps between different time units

* `apoc.date.convert(12345, 'ms', 'd')` convert a timestamp in one time unit into one of a different time unit

* possible unit values: `ms,s,m,h,d` and their long forms.

== Adding/subtracting time unit values to timestamps

* `apoc.date.add(12345, 'ms', -365, 'd')` given a timestamp in one time unit, adds a value of the specified time unit

* possible unit values: `ms,s,m,h,d` and their long forms.

== Reading separate datetime fields:

Splits date (optionally, using given custom format) into fields returning a map from field name to its value.

[source,cypher]
----
RETURN apoc.date.fields('2015-03-25 03:15:59')
----

.The following returns the fields in a date and time:
[source,cypher]
----
RETURN apoc.date.fields('2015-01-02 03:04:05 EET', 'yyyy-MM-dd HH:mm:ss zzz') AS output;
----

.Results
[opts="header",cols="1"]
|===
| Output
|  {
    'weekdays': 5,
    'years': 2015,
    'seconds': 5,
    'zoneid': 'EET',
    'minutes': 4,
    'hours': 3,
    'months': 1,
    'days': 2
  }
|===

.The following returns the fields in a date:
[source,cypher]
----
RETURN apoc.date.fields('2015/01/02_EET', 'yyyy/MM/dd_z') AS output;
----

.Results
[opts="header",cols="1"]
|===
| Output
|  {
    'weekdays': 5,
    'years': 2015,
    'zoneid': 'EET',
    'months': 1,
    'days': 2
  }
|===

== Reading single datetime field from UTC Epoch:

Extracts the value of one field from a datetime epoch.

[source,cypher]
----
RETURN apoc.date.field(12345)
----


Following fields are supported:

[options="header"]
|===============================================================================================================
| Result field	| Represents
| 'years'		| year
| 'months' 		| month of year
| 'days' 		| day of month (default)
| 'hours' 		| hour of day
| 'minutes' 	| minute of hour
| 'seconds'		| second of minute
| 'millis'		| milliseconds of a second
|===============================================================================================================

.The following returns the day of the month of the timestamp:
[source,cypher]
----
RETURN apoc.date.field(12345) AS output;
----

.Results
[opts="header",cols="1"]
|===
| Output
| 1
|===

.The following returns the year of the timestamp:
[source,cypher]
----
RETURN apoc.date.field(12345, 'years') AS output;
----

.Results
[opts="header",cols="1"]
|===
| Output
| 1970
|===

